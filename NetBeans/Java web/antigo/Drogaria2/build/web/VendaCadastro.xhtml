<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"     
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="templates/modeloGeral.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html">

    <ui:define name="metadata">
        <f:metadata>
            <f:event listener="#{MBVenda.carregarProdutos()}" type="preRenderView"/>
        </f:metadata>
    </ui:define> 
    
    <ui:define name="menu">
        <ui:include src="includes/menuPrincipal.xhtml"/>
    </ui:define>
    
    <ui:define name="conteudo">       
        <h:form id="frmTabela">             
            <p:dataTable id="tabela" widgetVar="table" value="#{MBVenda.listaProdutos}" filteredValue="#{MBVenda.listaProdutosFiltrados}" var="produto" paginator="true" rows="3" emptyMessage="Nenhum registro encontrado">
                <f:facet name="header">
                    <h:outputText value="Listagem de produtos"/>
                </f:facet>
                <p:column headerText="Codigo" width="10%">
                    <h:outputText value="#{produto.codigo}"/>
                </p:column>
                <p:column headerText="Descrição" filterBy="#{produto.descricao}" filterStyle="max-width:150px;">
                    <h:outputText value="#{produto.descricao}" />
                </p:column>
                <p:column headerText="Preço" width="10%">
                    <h:outputText value="#{produto.preco}"/>
                </p:column>
                <p:column headerText="Quantidade" width="10%">
                    <h:outputText value="#{produto.quantidade}"/>
                </p:column>
                <p:column headerText="Fabricante" filterBy="#{produto.fabricante.descricao}" filterStyle="max-width:150px;">
                    <h:outputText value="#{produto.fabricante.descricao}"/>
                </p:column>
                <p:column headerText="Opções" width="10%">
                    <p:commandButton value="Adicionar" actionListener="#{MBVenda.adicionar(produto)}" update=":frmTabelaItens:tabelaItens"/>                
                </p:column>
            </p:dataTable>
        </h:form>
        <!--.................................................................................................-->
         <p:separator/>
        <h:form id="frmTabelaItens">             
            <p:dataTable id="tabelaItens" widgetVar="tableItens" value="#{MBVenda.listaItens}" var="item" paginator="true" rows="3" emptyMessage="Nenhum registro encontrado">
                <f:facet name="header">
                    <h:outputText value="Carrinho de compras"/>
                </f:facet>                
                <p:column headerText="Produto">
                    <h:outputText value="#{item.produtos.descricao}"/>
                </p:column>
                 <p:column headerText="Fabricante">
                     <h:outputText value="#{item.produtos.fabricante.descricao}"/>
                </p:column>
                <p:column headerText="Quantidade" width="10%" footerText="Total #{MBVenda.venda.quantidade}">
                    <h:outputText value="#{item.quantidade}" />
                </p:column>
                <p:column headerText="Valor" width="10%" footerText="Total #{MBVenda.venda.valor}">
                    <h:outputText value="#{item.valor}"/>
                </p:column>                
                <p:column headerText="Opções" width="10%">
                    <p:commandButton value="Remover" actionListener="#{MBVenda.remover(item)}" update=":frmTabelaItens:tabelaItens"/>                
                </p:column>    
            </p:dataTable>
            <center><p:commandButton value="Finalizar" style="width:99%; background-color:yellowgreen" actionListener="#{MBVenda.carregarDadosVenda()}" oncomplete="PF('dlg').show();" update=":frmdlg:paneldlg"/></center>
        </h:form>  
    <!--............................................................................................................................................-->
         <p:dialog widgetVar="dlg" closable="false" draggable="false" resizable="false" modal="true" header="Finalização da venda" appendTo="@(body)">
            <h:form id="frmdlg">
                <h:panelGrid columns="2" id="paneldlg">
                    <h:outputText value="Horario:"/>
                    <h:outputText value="#{MBVenda.venda.horario}">
                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="America/Sao_Paulo"/>
                    </h:outputText>                   
                    <h:outputText value="Funcionario:"/>
                    <h:outputText value="#{MBVenda.venda.funcionarios.nome}"/>
                    <h:outputText value="Valor Total:"/>
                    <h:outputText value="#{MBVenda.venda.valor}"/>
                </h:panelGrid>  
                <h:panelGrid columns="2">
                    <p:commandButton value="Finalizar" actionListener="#{MBVenda.salvar()}" update=":frmTabelaItens:tabelaItens :msgGlobal" oncomplete="PF('dlg').hide();"/>
                        <p:commandButton value="Cancelar" onclick="PF('dlg').hide();"/>                     
                    </h:panelGrid>
            </h:form>            
        </p:dialog>
   </ui:define> 
</ui:composition>

